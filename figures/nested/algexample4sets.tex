%!TEX root = ../main/main.tex

\def\xfac{1.0}
\def\xcoors{{0,1*\xfac,3*\xfac,5*\xfac,7*\xfac,9*\xfac,11*\xfac,13*\xfac}}
\def\ycoors{{5.5 , 5 , 4.5 , 4 , 0.5 , 0 , 2.5 , 2 , 1.5 , 1 , 6 , 6.3}}
\newcommand{\rectang}[4]{\draw[-,dashed,gray] (#1-#2,#3) -- (#1+#2,#3) -- (#1+#2,#3-#4) -- (#1-#2,#3-#4) -- (#1-#2,#3)}
\def\tprod{\footnotesize {\sf pr}}
\def\tunion{\footnotesize {\sf un}}
\begin{figure}[t]
	\centering
	
	\begin{tikzpicture}[xscale=1.0,->,>=stealth',shorten >=1pt,auto,node distance=2cm,thick,inner sep=0.5pt, rectangle]
		
		%		\node at (\xcoors[0],\ycoors[11]) {$\Stream \ \ \  :$};
		\node at (\xcoors[1]+1,\ycoors[11]) {\large{\tt <}};
		\node at (\xcoors[2]+1,\ycoors[11]) {\large{\tt <}};
		\node at (\xcoors[3]+1,\ycoors[11]) {\large{\tt >}};
		\node at (\xcoors[4]+1,\ycoors[11]) {\large{\tt <}};
		\node at (\xcoors[5]+1,\ycoors[11]) {\large{\tt >}};
		\node at (\xcoors[6]+1,\ycoors[11]) {\large{\tt >}};
		
		\node at (\xcoors[1],\ycoors[10]) {\small 1};
		\node at (\xcoors[2],\ycoors[10]) {\small 2};
		\node at (\xcoors[3],\ycoors[10]) {\small 3};
		\node at (\xcoors[4],\ycoors[10]) {\small 4};
		\node at (\xcoors[5],\ycoors[10]) {\small 5};
		\node at (\xcoors[6],\ycoors[10]) {\small 6};
		\node at (\xcoors[7],\ycoors[10]) {\small 7};
	
		\draw[-,dashed,gray](\xcoors[1]-0.5,-0.4) -- (\xcoors[1] + 0.98,-0.4);
		\rectang{\xcoors[2]}{0.98}{0.7}{1.1};
		\rectang{\xcoors[3]}{0.98}{0.7}{1.1};
		\rectang{\xcoors[4]}{0.98}{0.7}{1.1};
		\rectang{\xcoors[5]}{0.98}{0.7}{1.1};
		\rectang{\xcoors[6]}{0.98}{0.7}{1.1};
		\draw[-,dashed,gray](\xcoors[7] - 0.98,-0.4) -- (\xcoors[7] + 0.98,-0.4);
		
		\rectang{\xcoors[3]}{0.98}{2.7}{1.9};
		\rectang{\xcoors[5]}{0.98}{2.7}{1.9};
		
		%		\draw[-] (-0.7,4.75) -- (12.5,4.75);
		%		\draw[-,dashed] (-0.7,2.75) -- (0.7,2.75);
		%		\draw[-] (-0.7,1.75) -- (12.5,1.75);
		%		\draw[-] (-0.7,-0.25) -- (12.5,-0.25);
		
		%		\node at (\xcoors[0]-0.9,\ycoors[0]) {\large $S:$};
		%		\node at (\xcoors[0]-0.9,\ycoors[4]) {\large $T_1$};
		%		\node at (\xcoors[0]-0.9,\ycoors[6]) {\large $T:$};
		
		%		\node (labelS_11) at (\xcoors[0],\ycoors[0]) {\footnotesize $1,1$};
		%		\node (labelS_22) at (\xcoors[0],\ycoors[1]) {\footnotesize$2,2$};
		%		\node (labelS_13) at (\xcoors[0],\ycoors[2]) {\footnotesize$1,3$};
		%		\node (labelS_33) at (\xcoors[0],\ycoors[3]) {\footnotesize$3,3$};
		%		\node (labelT1_1x1) at (\xcoors[0],\ycoors[4]) {\footnotesize$1,\textsf{X},1$};
		%		\node (labelT1_1y2) at (\xcoors[0],\ycoors[5]) {\footnotesize$1,\textsf{Y},2$};
		%		\node (labelT2_1x1) at (\xcoors[0],\ycoors[6]) {\footnotesize$1,\textsf{X},1$};
		%		\node (labelT2_1y2) at (\xcoors[0],\ycoors[7]) {\footnotesize$1,\textsf{Y},2$};
		%		\node (labelT2_2x2) at (\xcoors[0],\ycoors[8]) {\footnotesize$2,\textsf{X},2$};
		%		\node (labelT2_1x3) at (\xcoors[0],\ycoors[9]) {\footnotesize$1,\textsf{X},q_p$};
		
		\node (S_11_1) at (\xcoors[1],\ycoors[0]) {\tiny$S^1_{1,1}\!\!: \eps$};
		
		\node (S_11_2) at (\xcoors[2],\ycoors[0]) {\tiny$S^2_{1,1}\!\!: \eps$};
		\node (S_22_2) at (\xcoors[2],\ycoors[1]) {\tiny$S^2_{2,2}\!\!: \eps$};
		
		\node (S_11_3) at (\xcoors[3],\ycoors[0]) {\tiny$S^3_{1,1}\!\!: \eps$};
		\node (S_22_3) at (\xcoors[3],\ycoors[1]) {\tiny$S^3_{2,2}\!\!:\eps$};
		
		\node[anchor=west] (S_11_4) at (\xcoors[4]-1.0,\ycoors[0]) {\tiny$S^4_{1,1}\!\!: \textsf{p}(T^3_{1,\textsf{X},1},S^3_{1,1})$};
		\node[anchor=west] (S_22_4) at (\xcoors[4]-1.0,\ycoors[1]) {\tiny$S^4_{2,2}\!\!:\textsf{p}(T^3_{2,\textsf{X},2},S^3_{2,2})$};
		\node[anchor=west] (S_13_4) at (\xcoors[4]-1.0,\ycoors[2]) {\tiny$S^4_{1,3}\!\!:\textsf{p}(T^3_{1,\textsf{Y}, 2},S^3_{2,2},(\triangleleft,3))$};
		
		\node (S_11_5) at (\xcoors[5],\ycoors[0]) {\tiny$S^5_{1,1}\!\!: \eps$};
		\node (S_22_5) at (\xcoors[5],\ycoors[1]) {\tiny$S^5_{2,2}\!\!:\eps$};
		\node (S_33_5) at (\xcoors[5],\ycoors[3]) {\tiny$S^5_{3,3}\!\!:\eps$};
		
		\node[anchor=west] (S_11_6) at (\xcoors[6]-1.0,\ycoors[0]) {\tiny$S^6_{1,1}\!\!: \textsf{p}(T^5_{1,\textsf{X},1},S^5_{1,1})$};
		\node[anchor=west] (S_22_6) at (\xcoors[6]-1.0,\ycoors[1]) {\tiny$S^6_{1,1}\!\!:\textsf{p}(T^5_{2,\textsf{X},2},S^5_{2,2})$};
		\node[anchor=west] (S_13_6) at (\xcoors[6]-1.0,\ycoors[2]) {\tiny$S^6_{1,3}\!\!:\union($};
		\node[anchor=west] (S_13_6a) at (\xcoors[6]-0.75,\ycoors[2]-0.5) {\tiny$\textsf{p}(T^5_{1,\textsf{Y},2},S^5_{2,2},(\triangleleft,5))$};
		\node[anchor=west] (S_13_6b) at (\xcoors[6]-0.75,\ycoors[2]-1) {\tiny$\textsf{p}(T^5_{1,\textsf{X},3},S^5_{3,3}))$};
		
		
		\node[anchor=west] (S_11_7) at (\xcoors[7]-0.9,\ycoors[0]) {\tiny$S^7_{1,1}\!\!: \textsf{p}(T^2_{1,\textsf{X},1},S^6_{1,1})$};
		\node[anchor=west] (S_13_7) at (\xcoors[7]-0.9,\ycoors[2]) {\tiny$S^7_{1,3}\!\!:\union($};
		\node[anchor=west] (S_13_7a) at (\xcoors[7]-0.6,\ycoors[2]-0.5) {\tiny$\textsf{p}(T^2_{1,\textsf{Y},2},S^6_{2,2},(\triangleleft,6))$};
		\node[anchor=west] (S_13_7b) at (\xcoors[7]-0.6,\ycoors[2]-1) {\tiny$\textsf{p}(T^2_{1,\textsf{X},3},S^6_{3,3}))$};
		
		\node (T1_1x1_2) at (\xcoors[2], \ycoors[4]) {\scriptsize$T^2_{1,\textsf{X},1}\!\!: S^1_{1,1}$};
		%		\node[text width=1.65cm,anchor=north west,execute at begin node=\setlength{\baselineskip}{0.5em},align=right] (T1_1y2_2) at (\xcoors[2]-0.85, \ycoors[5]+0.55) {\scriptsize$T^2_{2,\textsf{Y},2}\!\!:\textsf{p}(\,\,$ $\ \ S^1_{1,1}, (\triangleright,1))$};
		\node(T1_1y2_2) at (\xcoors[2], \ycoors[5]) {\tiny$T^2_{1,\textsf{Y},2}\!\!:\textsf{p}(S^1_{1,1},(\triangleright,1))$};
		
		\node (T1_1x1_3) at (\xcoors[3], \ycoors[4]) {\tiny$T^2_{1,\textsf{X},1}$};
		\node(T1_1y2_3) at (\xcoors[3], \ycoors[5]) {\tiny$T^2_{1,\textsf{Y},2}$};
		
		\node (T1_1x1_4) at (\xcoors[4], \ycoors[4]) {\tiny$T^2_{1,\textsf{X},1}$};
		\node(T1_1y2_4) at (\xcoors[4], \ycoors[5]) {\tiny$T^2_{1,\textsf{Y},2}$};
		
		\node (T1_1x1_5) at (\xcoors[5], \ycoors[4]) {\tiny$T^2_{1,\textsf{X},1}$};
		\node(T1_1y2_5) at (\xcoors[5], \ycoors[5]) {\tiny$T^2_{1,\textsf{Y},2}$};
		
		\node (T1_1x1_6) at (\xcoors[6], \ycoors[4]) {\tiny$T^2_{1,\textsf{X},1}$};
		\node(T1_1y2_6) at (\xcoors[6], \ycoors[5]) {\tiny$T^2_{1,\textsf{Y},2}$};
		
		
		\node (T2_1x1_3) at (\xcoors[3], \ycoors[6]) {\tiny$T^3_{1,\textsf{X},1}\!\!: S^2_{1,1}$};
		\node (T2_1y2_3) at (\xcoors[3], \ycoors[7]) {\tiny$T^3_{1,\textsf{Y},2}\!\!:\textsf{p}(S^2_{1,1},(\triangleright,2))$};
		\node (T2_2x2_3) at (\xcoors[3], \ycoors[8]) {\tiny$T^5_{2,\textsf{X},2}\!\!:S^2_{2,2}$};
		
		\node (T2_1x1_5) at (\xcoors[5], \ycoors[6]) {\tiny$T^5_{1,\textsf{X},1}\!\!:S^4_{1,1}$};
		\node (T2_1y2_5) at (\xcoors[5], \ycoors[7]) {\tiny$T^5_{1,\textsf{Y},2}\!\!:\textsf{p}(S^4_{1,1},(\triangleright,4))$};
		\node (T2_2x2_5) at (\xcoors[5], \ycoors[8]) {\tiny$T^5_{2,\textsf{X},2}\!\!:S^2_{2,2}$};
		\node (T2_1x3_5) at (\xcoors[5], \ycoors[9]) {\tiny$T^5_{1,\textsf{X},3}\!\!:S^4_{1,3}$};
		
		%		\def\edgea{\draw[gray,out=110,in=-50]}
		%		\def\edgeb{\draw[gray]}
		%		\def\edgec{\draw[gray,out=220,in=20]}
		%		
		%		\draw[gray] (T1_1x1_2) to (S_11_1);
		%		\edgeb (T1_1y2_2.west) to (S_11_1);
		%		\draw[gray] (T1_1y2_2.west) to (out1.east);
		%		
		%		\edgec (T2_1x1_3) to (S_11_2);
		%		\edgec (T2_1y2_3.west) to (S_11_2);
		%		\edgec (T2_2x2_3) to (S_22_2);
		%		\draw[gray] (T2_1y2_3.west) to (out2.east);
		%		
		%		\edgea (S_11_4.west) to (T2_1x1_3.east);
		%		\draw[gray] (S_11_4.west) to (S_11_3.east);
		%		\edgea (S_22_4.west) to (T2_2x2_3.east);
		%		\draw[gray] (S_22_4.west) to (S_22_3.east);
		%		\edgea (S_13_4.west) to (T2_1y2_3.east);
		%		\draw[gray] (S_13_4.west) to (S_22_3.east);
		%		\draw[gray] (S_13_4.west) to (out3.east);
		%		
		%		\edgec[gray!40] (T2_1x1_5.west) to (S_11_4.east);
		%		\edgec (T2_1y2_5.west) to (S_11_4.east);
		%		\edgec (T2_2x2_5.west) to (S_22_4.east);
		%		\edgec (T2_1x3_5.west) to (S_13_4.east);
		%		\draw[gray] (T2_1y2_5.west) to (out4.east);
		%		
		%		\edgea[gray!40] (S_11_6.west) to (T2_1x1_5.east);
		%		\draw[gray!40] (S_11_6.west) to (S_11_5.east);
		%		\edgea (S_22_6.west) to (T2_2x2_5.east);
		%		\draw[gray] (S_22_6.west) to (S_22_5.east);
		%		\edgea (S_13_6a.west) to (T2_1y2_5.east);
		%		\draw[gray] (S_13_6a.west) to (S_22_5.east);
		%		\edgea (S_13_6b.west) to (T2_1x3_5.east);
		%		\draw[gray] (S_13_6b.west) to (S_33_5.east);
		%		\draw[gray,-] (S_13_6.west) to (S_13_6a.east);
		%		\draw[gray,-] (S_13_6.west) to (S_13_6b.east);
		%		\draw[gray] (S_13_6a.west) to (out5.east);
		%		
		%		\draw[gray!40,out=150,in=-20] (S_11_7.west) to (T1_1x1_6);
		%		\draw[gray!40] (S_11_7.west) to (S_11_6.east);
		%		\draw[gray,out=150,in=-20] (S_13_7a.west) to (T1_1y2_6);
		%		\draw[gray] (S_13_7a.west) to (S_22_6.east);
		%		\draw[gray,out=130,in=-20] (S_13_7b.west) to (T1_1x1_6);
		%		\draw[gray] (S_13_7b.west) to (S_13_6.east);
		%		\draw[gray,-] (S_13_7.west) to (S_13_7a.east);
		%		\draw[gray,-] (S_13_7.west) to (S_13_7b.east);
		%		\draw[gray] (S_13_7a.west) to (out6);
	\end{tikzpicture}
	\caption{Example of running Algorithm~\ref{alg:preprocessing} over the VPAnn $\cT_1$ and a stream $\Stream$ such that $\Stream[1,6] = {\tt < < > < > >}$.}
	\label{nested:fig-alg-ex}
\end{figure}